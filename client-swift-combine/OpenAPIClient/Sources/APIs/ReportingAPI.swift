//
// ReportingAPI.swift
//
// Generated by openapi-generator
// https://openapi-generator.tech

import Foundation
import Combine
import OpenAPITransport


open class ReportingAPI {
    private let transport: OpenAPITransport
    public var encoder: JSONEncoder = {
        let encoder = JSONEncoder()
        encoder.dateEncodingStrategy = .formatted(OpenISO8601DateFormatter())
        return encoder
    }()
    public var decoder: JSONDecoder = {
        let decoder = JSONDecoder()
        decoder.dateDecodingStrategy = .formatted(OpenISO8601DateFormatter())
        return decoder
    }()
    public var baseURL = URL(string: "http://localhost")

    public init(_ transport: OpenAPITransport) {
        self.transport = transport
    }

    ///
    /// Enum for parameter status
    ///
    public enum CreateBatchStatus: String, Codable, CaseIterable {
        case new = "NEW"
        case error = "ERROR"
        case complete = "COMPLETE"
        case parseError = "PARSE_ERROR"
        case processing = "PROCESSING"
        case duplicate = "DUPLICATE"
        case saveonly = "SAVEONLY"
    }

    /// Create Offline Report
    /// - POST /api/{version}/report/batch/create
    /// - Create an entry for the batch for offline report
    /// - parameter version: (path)  
    /// - parameter accountId: (query) The account id of the user for passing account related params 
    /// - parameter status: (query) the status of the report 
    /// - parameter previewLimit: (query) the limit on how much you can preview of the batch report 
    /// - parameter appKey: (query) The application key for passing application related params (optional)
    /// - parameter endpoint: (query)  (optional)
    /// - parameter parameters: (query) a json structure list of the parameter values, example: &#x60;&#x60;&#x60;json {   \&quot;string\&quot;:\&quot;value\&quot;,    \&quot;number\&quot;:3.345,   \&quot;date\&quot;:\&quot;2014-05-01 00:00:00\&quot; } &#x60;&#x60;&#x60;  (optional)
    /// - parameter name: (query) name of the batch report (optional)
    /// - parameter startDate: (query) the start date of the batch report (optional)
    /// - parameter endDate: (query) the end date of the batch report (optional)
    /// - parameter description: (query) the description of the batch report (optional)
    /// - parameter pageUrl: (query)  (optional)
    /// - returns: AnyPublisher<ReportBatchResponse, Error> 
    open func createBatch(version: Double, accountId: Int64, status: CreateBatchStatus, previewLimit: Int, appKey: String? = nil, endpoint: String? = nil, parameters: String? = nil, name: String? = nil, startDate: Int64? = nil, endDate: Int64? = nil, description: String? = nil, pageUrl: String? = nil) -> AnyPublisher<ReportBatchResponse, Error> {
        Deferred {
            Result<URLRequest, Error> {
                guard let baseURL = self.transport.baseURL ?? self.baseURL else {
                    throw OpenAPITransportError.badURLError()
                }
                var localVarPath = "/api/{version}/report/batch/create"
                localVarPath = localVarPath.replacingOccurrences(of: "{version}", with: "\(version)")
                let localVarURL = baseURL.appendingPathComponent(localVarPath)
                var components = URLComponents(url: localVarURL, resolvingAgainstBaseURL: false)
                var queryItems: [URLQueryItem] = []
                queryItems.append(URLQueryItem(name: "accountId", value: "\(accountId)"))
                if let appKey = appKey { queryItems.append(URLQueryItem(name: "appKey", value: appKey)) } 
                queryItems.append(URLQueryItem(name: "status", value: status.rawValue))
                if let endpoint = endpoint { queryItems.append(URLQueryItem(name: "endpoint", value: endpoint)) } 
                if let parameters = parameters { queryItems.append(URLQueryItem(name: "parameters", value: parameters)) } 
                if let name = name { queryItems.append(URLQueryItem(name: "name", value: name)) } 
                if let startDate = startDate { queryItems.append(URLQueryItem(name: "startDate", value: "\(startDate)")) } 
                if let endDate = endDate { queryItems.append(URLQueryItem(name: "endDate", value: "\(endDate)")) } 
                if let description = description { queryItems.append(URLQueryItem(name: "description", value: description)) } 
                queryItems.append(URLQueryItem(name: "previewLimit", value: "\(previewLimit)"))
                if let pageUrl = pageUrl { queryItems.append(URLQueryItem(name: "pageUrl", value: pageUrl)) } 
                components?.queryItems = queryItems
                guard let requestURL = components?.url else {
                    throw OpenAPITransportError.badURLError()
                }
                var request = URLRequest(url: requestURL)
                request.httpMethod = "POST"
                return request
            }.publisher
        }.flatMap { request -> AnyPublisher<ReportBatchResponse, Error> in 
            return self.transport.send(request: request)
                .tryMap { response in
                    try self.decoder.decode(ReportBatchResponse.self, from: response.data)
                }
                .eraseToAnyPublisher()
        }.eraseToAnyPublisher()
    }


    /// Create Offline Report
    /// - POST /api/{version}/report/region/summary/batch
    /// - Create an entry for the batch for offline report
    /// - parameter version: (path)  
    /// - parameter body: (body)  (optional)
    /// - returns: AnyPublisher<ReportRegionLegSummaryBatchResponse, Error> 
    open func createRegionLegSummaryBatch(version: Double, body: [RegionLegSummary]? = nil) -> AnyPublisher<ReportRegionLegSummaryBatchResponse, Error> {
        Deferred {
            Result<URLRequest, Error> {
                guard let baseURL = self.transport.baseURL ?? self.baseURL else {
                    throw OpenAPITransportError.badURLError()
                }
                var localVarPath = "/api/{version}/report/region/summary/batch"
                localVarPath = localVarPath.replacingOccurrences(of: "{version}", with: "\(version)")
                let localVarURL = baseURL.appendingPathComponent(localVarPath)
                let components = URLComponents(url: localVarURL, resolvingAgainstBaseURL: false)
                guard let requestURL = components?.url else {
                    throw OpenAPITransportError.badURLError()
                }
                var request = URLRequest(url: requestURL)
                request.httpMethod = "POST"
                request.httpBody = try self.encoder.encode(body)
                request.setValue("application/json", forHTTPHeaderField: "Content-Type")
                return request
            }.publisher
        }.flatMap { request -> AnyPublisher<ReportRegionLegSummaryBatchResponse, Error> in 
            return self.transport.send(request: request)
                .tryMap { response in
                    try self.decoder.decode(ReportRegionLegSummaryBatchResponse.self, from: response.data)
                }
                .eraseToAnyPublisher()
        }.eraseToAnyPublisher()
    }


    /// Delete Offline Report
    /// - POST /api/{version}/report/batch/delete
    /// - Deletes a batch report.
    /// - parameter version: (path)  
    /// - parameter accountId: (query) the id of the account 
    /// - parameter batchId: (query) the id of the batch to delete 
    /// - returns: AnyPublisher<SirqulResponse, Error> 
    open func deleteBatch(version: Double, accountId: Int64, batchId: Int64) -> AnyPublisher<SirqulResponse, Error> {
        Deferred {
            Result<URLRequest, Error> {
                guard let baseURL = self.transport.baseURL ?? self.baseURL else {
                    throw OpenAPITransportError.badURLError()
                }
                var localVarPath = "/api/{version}/report/batch/delete"
                localVarPath = localVarPath.replacingOccurrences(of: "{version}", with: "\(version)")
                let localVarURL = baseURL.appendingPathComponent(localVarPath)
                var components = URLComponents(url: localVarURL, resolvingAgainstBaseURL: false)
                var queryItems: [URLQueryItem] = []
                queryItems.append(URLQueryItem(name: "accountId", value: "\(accountId)"))
                queryItems.append(URLQueryItem(name: "batchId", value: "\(batchId)"))
                components?.queryItems = queryItems
                guard let requestURL = components?.url else {
                    throw OpenAPITransportError.badURLError()
                }
                var request = URLRequest(url: requestURL)
                request.httpMethod = "POST"
                return request
            }.publisher
        }.flatMap { request -> AnyPublisher<SirqulResponse, Error> in 
            return self.transport.send(request: request)
                .tryMap { response in
                    try self.decoder.decode(SirqulResponse.self, from: response.data)
                }
                .eraseToAnyPublisher()
        }.eraseToAnyPublisher()
    }


    /// Get Offline Report
    /// - GET /api/{version}/report/batch/get
    /// - Checks status of batch report.
    /// - parameter version: (path)  
    /// - parameter accountId: (query) the id of the logged in user 
    /// - parameter batchId: (query) returned by /report/batch/create 
    /// - parameter allResults: (query) whether to return all batch results or not 
    /// - returns: AnyPublisher<ReportBatchResponse, Error> 
    open func getReportBatch(version: Double, accountId: Int64, batchId: Int64, allResults: Bool) -> AnyPublisher<ReportBatchResponse, Error> {
        Deferred {
            Result<URLRequest, Error> {
                guard let baseURL = self.transport.baseURL ?? self.baseURL else {
                    throw OpenAPITransportError.badURLError()
                }
                var localVarPath = "/api/{version}/report/batch/get"
                localVarPath = localVarPath.replacingOccurrences(of: "{version}", with: "\(version)")
                let localVarURL = baseURL.appendingPathComponent(localVarPath)
                var components = URLComponents(url: localVarURL, resolvingAgainstBaseURL: false)
                var queryItems: [URLQueryItem] = []
                queryItems.append(URLQueryItem(name: "accountId", value: "\(accountId)"))
                queryItems.append(URLQueryItem(name: "batchId", value: "\(batchId)"))
                queryItems.append(URLQueryItem(name: "allResults", value: allResults ? "true" : "false"))
                components?.queryItems = queryItems
                guard let requestURL = components?.url else {
                    throw OpenAPITransportError.badURLError()
                }
                var request = URLRequest(url: requestURL)
                request.httpMethod = "GET"
                return request
            }.publisher
        }.flatMap { request -> AnyPublisher<ReportBatchResponse, Error> in 
            return self.transport.send(request: request)
                .tryMap { response in
                    try self.decoder.decode(ReportBatchResponse.self, from: response.data)
                }
                .eraseToAnyPublisher()
        }.eraseToAnyPublisher()
    }

    ///
    /// Enum for parameter responseFormat
    ///
    public enum RunReportResponseFormat: String, Codable, CaseIterable {
        case html = "HTML"
        case xml = "XML"
        case json = "JSON"
        case csv = "CSV"
    }

    /// Run Report
    /// - POST /api/{version}/report/run
    /// -  This endpoint allows you to run a set of predefined reports that can be used to understand your users' behavior as well as trends within your application.
    /// - parameter version: (path)  
    /// - parameter desc: (query) If true then descending order, false is ascending 
    /// - parameter accountId: (query) The account id of the user for passing account related params (optional)
    /// - parameter query: (query) The named identifier of the query (optional)
    /// - parameter parameters: (query) Parameter values used in the query in JSON format, example: &#x60;&#x60;&#x60;json {   \&quot;string\&quot;:\&quot;value\&quot;,    \&quot;number\&quot;:3.345,   \&quot;date\&quot;:\&quot;2014-05-01 00:00:00\&quot; } &#x60;&#x60;&#x60;  (optional)
    /// - parameter order: (query) The order to use, must be a column name (see response results for list of column names) (optional)
    /// - parameter start: (query) The start of the pagination (optional)
    /// - parameter limit: (query) The limit of the pagination (optional)
    /// - parameter responseFormat: (query) Determines what response format to return. Options are: JSON or CSV (optional)
    /// - returns: AnyPublisher<ReportResponse, Error> 
    open func runReport(version: Double, desc: Bool, accountId: Int64? = nil, query: String? = nil, parameters: String? = nil, order: String? = nil, start: Int64? = nil, limit: Int64? = nil, responseFormat: RunReportResponseFormat? = nil) -> AnyPublisher<ReportResponse, Error> {
        Deferred {
            Result<URLRequest, Error> {
                guard let baseURL = self.transport.baseURL ?? self.baseURL else {
                    throw OpenAPITransportError.badURLError()
                }
                var localVarPath = "/api/{version}/report/run"
                localVarPath = localVarPath.replacingOccurrences(of: "{version}", with: "\(version)")
                let localVarURL = baseURL.appendingPathComponent(localVarPath)
                var components = URLComponents(url: localVarURL, resolvingAgainstBaseURL: false)
                var queryItems: [URLQueryItem] = []
                if let accountId = accountId { queryItems.append(URLQueryItem(name: "accountId", value: "\(accountId)")) } 
                if let query = query { queryItems.append(URLQueryItem(name: "query", value: query)) } 
                if let parameters = parameters { queryItems.append(URLQueryItem(name: "parameters", value: parameters)) } 
                if let order = order { queryItems.append(URLQueryItem(name: "order", value: order)) } 
                queryItems.append(URLQueryItem(name: "desc", value: desc ? "true" : "false"))
                if let start = start { queryItems.append(URLQueryItem(name: "start", value: "\(start)")) } 
                if let limit = limit { queryItems.append(URLQueryItem(name: "limit", value: "\(limit)")) } 
                if let responseFormat = responseFormat { queryItems.append(URLQueryItem(name: "responseFormat", value: responseFormat.rawValue)) } 
                components?.queryItems = queryItems
                guard let requestURL = components?.url else {
                    throw OpenAPITransportError.badURLError()
                }
                var request = URLRequest(url: requestURL)
                request.httpMethod = "POST"
                return request
            }.publisher
        }.flatMap { request -> AnyPublisher<ReportResponse, Error> in 
            return self.transport.send(request: request)
                .tryMap { response in
                    try self.decoder.decode(ReportResponse.self, from: response.data)
                }
                .eraseToAnyPublisher()
        }.eraseToAnyPublisher()
    }

    ///
    /// Enum for parameter status
    ///
    public enum SearchBatchStatus: String, Codable, CaseIterable {
        case new = "NEW"
        case error = "ERROR"
        case complete = "COMPLETE"
        case parseError = "PARSE_ERROR"
        case processing = "PROCESSING"
        case duplicate = "DUPLICATE"
        case saveonly = "SAVEONLY"
    }

    /// Search Offline Reports
    /// - GET /api/{version}/report/batch/search
    /// - Retrieves batches for a user..
    /// - parameter version: (path)  
    /// - parameter accountId: (query) the id of the account logged in 
    /// - parameter start: (query) the start of the index and/or pagination 
    /// - parameter limit: (query) the limit of the index and/or pagination 
    /// - parameter names: (query) the names of the report batch to search on (optional)
    /// - parameter appKey: (query) the application key (optional)
    /// - parameter status: (query) the report batch status (optional)
    /// - parameter globalAppSearch: (query) the global app to search on (optional)
    /// - parameter startDate: (query) the start date of the report batch to search on (optional)
    /// - parameter endDate: (query) the end date of the report batch to search on (optional)
    /// - returns: AnyPublisher<[ReportBatchResponse], Error> 
    open func searchBatch(version: Double, accountId: Int64, start: Int, limit: Int, names: String? = nil, appKey: String? = nil, status: SearchBatchStatus? = nil, globalAppSearch: Bool? = nil, startDate: Int64? = nil, endDate: Int64? = nil) -> AnyPublisher<[ReportBatchResponse], Error> {
        Deferred {
            Result<URLRequest, Error> {
                guard let baseURL = self.transport.baseURL ?? self.baseURL else {
                    throw OpenAPITransportError.badURLError()
                }
                var localVarPath = "/api/{version}/report/batch/search"
                localVarPath = localVarPath.replacingOccurrences(of: "{version}", with: "\(version)")
                let localVarURL = baseURL.appendingPathComponent(localVarPath)
                var components = URLComponents(url: localVarURL, resolvingAgainstBaseURL: false)
                var queryItems: [URLQueryItem] = []
                queryItems.append(URLQueryItem(name: "accountId", value: "\(accountId)"))
                if let names = names { queryItems.append(URLQueryItem(name: "names", value: names)) } 
                if let appKey = appKey { queryItems.append(URLQueryItem(name: "appKey", value: appKey)) } 
                if let status = status { queryItems.append(URLQueryItem(name: "status", value: status.rawValue)) } 
                if let globalAppSearch = globalAppSearch { queryItems.append(URLQueryItem(name: "globalAppSearch", value: globalAppSearch ? "true" : "false")) } 
                if let startDate = startDate { queryItems.append(URLQueryItem(name: "startDate", value: "\(startDate)")) } 
                if let endDate = endDate { queryItems.append(URLQueryItem(name: "endDate", value: "\(endDate)")) } 
                queryItems.append(URLQueryItem(name: "start", value: "\(start)"))
                queryItems.append(URLQueryItem(name: "limit", value: "\(limit)"))
                components?.queryItems = queryItems
                guard let requestURL = components?.url else {
                    throw OpenAPITransportError.badURLError()
                }
                var request = URLRequest(url: requestURL)
                request.httpMethod = "GET"
                return request
            }.publisher
        }.flatMap { request -> AnyPublisher<[ReportBatchResponse], Error> in 
            return self.transport.send(request: request)
                .tryMap { response in
                    try self.decoder.decode([ReportBatchResponse].self, from: response.data)
                }
                .eraseToAnyPublisher()
        }.eraseToAnyPublisher()
    }
}
